---
layout: post

title: 1년 전 개발한 프로젝트 건드려보기 3 > 본격! 리팩토링! 1편 > 긴 메서드 줄이기

subtitle: Looking at a project developed a year ago - Let's go Refactoring! #1

excerpt: "1년 전에 개발한 프로젝트를 다시 살펴보고, 그동안 얼마나 성장했는지 알아보려고 합니다."

tags:
  - Java
  - Springboot
  - Toy
  - Refactoring
  - Code Smell
  
published: true
---

# 본격! 리팩토링! 1편!
## 키 190cm 모델보다 긴 메서드 수정하기!
*****
### 변경전 코드
##### Controller
![](/assets/2023-06-05/beforeController.png)
##### Service
![](/assets/2023-06-05/beforeService.png)
컨트롤러에서 호출하는 서비스 함수입니다.  
엄청 장황하죠?? (~~너무 길어서 캡쳐하려고 모니터 피벗했어요..~~)  

*****
### 변경후 코드
**짜잔!!** ...  코드를 간단하게 리팩터링 해왔습니다.  각 레이어 코드들의 변경점을 설명해드리겠습니다.
##### Controller
![](/assets/2023-06-05/afterController.png)
1. 메서드 이름을 직관적으로 변경
2. 메서드 추출
	- `createRequestDto` : Service 레이어로 전달할 DTO 생성하는 정적 팩토리 메서드
	- ![](/assets/2023-06-05/createRequestDto.png)
3. GET /favicon 생성
	- 로그를 확인하니, favicon 요청이 `/{hangul}`으로 빠지는 모습을 확인했습니다.
	- 이를 해결하기 위해 GET /favicon 요청을 void로 설정하였습니다.

##### Service
![](/assets/2023-06-05/afterService.png)
1. 메서드 이름을 직관적으로 변경
	- 기존 메서드 역할 :
		- 로그를 남기고, 짧은 url로 긴 url을 가져옴.
			-> 따라서 `getOriginalUrl`로 변경하였습니다.
2.  메서드 추출
	- 기존에 DB랑 Terminal에 Log를 남기는 메서드들 추출
		- `saveLogDatabase` : DB에 로그를 남김
		- `displayLogTerminal` : log.info() 형태로 터미널에 로그를 남김
	- IP정보로 Country 정보(String)를 가져오는 메서드 추출
		- ![](/assets/2023-06-05/ip-address-utils.png)
		- *여기서도 추가적으로 더 추출하였으나, 생략하겠습니다.*
3. 메서드 `@Transactional` 사용
	- 생성되지않은 짧은 링크에 대해 redirect를 요청할 시, 트랜젝션 rollBack에 의해 DB상에 로그도 남지 않겠끔 사용 하였습니다.
4. `Enum` 사용
	- 요구사항
		- 짧은 링크를 접속할때 헤더의 UserAgent정보를 파싱해서, 접속한 사용자의 OS, Browser 정보를 유추합니다. 
	- Before
		- ![](/assets/2023-06-05/beforeParse.png)
		- 원래는 위와 같은 방식을 사용 하고 있었습니다.
		- 하지만 UserAgent정보를 파싱하는 작업은 여러 메서드에서 사용하고 있기 때문에, 확장성과 가독성을 위해 Enum타입으로 분리하였습니다.
	- After
		![](/assets/2023-06-05/BrowserEnum.png)
		- `of` : Enum 내부 `signature`값이 포함되어 있는지의 유무로 Browser를 검사합니다.
			- Enum타입을 생성함에 따라 다음 처럼 UserAgent를 파싱할 수 있습니다.
			![](/assets/2023-06-05/parse.png)




_내용이 길어졌네요... 그럼, 다음편에서 봅시다._ ✋

